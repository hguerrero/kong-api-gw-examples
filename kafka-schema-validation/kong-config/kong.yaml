_format_version: "3.0"
_transform: true

services:
  - name: kafka-local
    url: tcp://localhost:9092
    routes:
    - name: kafka-producer-schema
      paths:
      - /kafka/schema/my-topic
    - name: kafka-consumer-schema
      paths:
      - /kafka/rest/no-schema/my-topic
    - name: kafka-consumer-schema-avro
      paths:
      - /kafka/rest/schema/avro/my-topic
    - name: kafka-consumer-sse-schema
      paths:
      - /kafka/sse/schema/avro/my-topic

plugins:
- name: kafka-upstream
  route: kafka-producer-schema
  config:
    bootstrap_servers:
    - host: kafka
      port: 9092
    topic: my-topic-schema
    producer_async: false
    schema_registry:
      confluent:
        url: http://schema-registry:8080/apis/ccompat/v7
        authentication:
          mode: none
          basic:
            username: user
            password: password
        value_schema:
          subject_name: user-value
          schema_version: latest
    message_by_lua_functions:
    - "return function(message) return message.body end"  
- name: kafka-consume
  route: kafka-consumer-schema
  config:
    topics: 
    - name: my-topic-schema
    bootstrap_servers:
    - host: kafka
      port: 9092
- name: kafka-consume
  route: kafka-consumer-schema-avro
  config:
    topics: 
    - name: my-topic-schema
    bootstrap_servers:
    - host: kafka
      port: 9092
    schema_registry:
      confluent:
        url: http://schema-registry:8080/apis/ccompat/v7
        authentication:
          mode: none
- name: kafka-consume
  route: kafka-consumer-sse-schema
  config:
    topics: 
    - name: my-topic-schema
    bootstrap_servers:
    - host: kafka
      port: 9092
    mode: server-sent-events
    schema_registry:
      confluent:
        url: http://schema-registry:8080/apis/ccompat/v7
        authentication:
          mode: none
